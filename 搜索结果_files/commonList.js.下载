CommonList=function(){};CommonList.prototype={searchPage:1,scrollTop:0,pageCount:0,much:3,shopId:null,keyword:null,searchSort:null,shopCategoryId:null,clickSku:null,skus:null,isEnd:false,loadflag:false,divId:null,pageFlag:null,timeout:2000,init:function(g,h){var i=this;this.divId=$("#"+g);this.pageFlag=h;this.shopId=$("#shopId").val();if(this.pageFlag!="index"){this.keyword=$("#keyword").val()}this.searchSort=$("#searchSort").val();if(this.searchSort==null||this.searchSort==""){this.searchSort=0}this.shopCategoryId=$("#shopCategoryId").val();this.scrollTop=$("#scrollTop").val();this.skus=$("#skus").val();this.clickSku=$("#clickSku").val();this.initTab(this.divId);this.initList(this.divId);var f=$("#searchPage").val();function j(){var a=i.searchPage-1;if(f>a){i.load(j)}else{if(!isNaN(i.scrollTop)){$(document).scrollTop(i.scrollTop)}}}if(!isNaN(f)&&f>1){--f;this.load(j)}else{this.load()}$(".empty-btn").on("click",function(){var a=$(this).attr("type");var b="";if(a=="all"){createMpingEvent("MShop_BlankCheckAll","1",window.location.pathname,$("#shopId").val(),"");b="/search/search?shopId="+$("#shopId").val()}else{createMpingEvent("MShop_BlankCheckAll","0",window.location.pathname,$("#shopId").val(),"");b="/?shopId="+$("#shopId").val()}if(b!=""){setTimeout(function(){window.location.href=b},100)}})},initTab:function(f){var h=this;var g='<div id="J-sortTab" class="sort-tab border-grids"><div class="ui-flex sort-content"><span name="search-sort-tab" searchSort="0" class="cell sort-item">推荐</span><span name="search-sort-tab" searchSort="1" class="cell sort-item">销量</span><span name="search-sort-tab" searchSort="5" class="cell sort-item">新品</span><span name="search-sort-tab" searchSort="3" id="J-priceSort" class="cell sort-item">价格<i class="sort-icon"></i></span></div></div>';f.html(g);$("span[name=search-sort-tab][searchSort="+h.searchSort+"]").addClass("active");$("span[name=search-sort-tab]").click(function(){var a=$(this).attr("searchSort");if(a==h.searchSort){return}h.searchSort=a;$("#searchSort").val(h.searchSort);if(h.searchSort==2){$(this).attr("searchSort",3)}else{if(h.searchSort==3){$(this).attr("searchSort",2)}}if(window.location.pathname=="/"||window.location.pathname.indexOf("index")!=-1){if(h.searchSort==0){createMpingEvent("MShop_Recommend","",window.location.pathname,h.shopId)}else{if(h.searchSort==1){createMpingEvent("MShop_Amount","",window.location.pathname,h.shopId)}else{if(h.searchSort==5){createMpingEvent("MShop_New","",window.location.pathname,h.shopId)}else{if(h.searchSort==2||h.searchSort==3){createMpingEvent("MShop_Price","",window.location.pathname,h.shopId)}}}}}else{if(h.searchSort==0){createMpingEvent("MShop_AllProductRec","",window.location.pathname,h.shopId)}else{if(h.searchSort==1){createMpingEvent("MShop_AllProductAmount","",window.location.pathname,h.shopId)}else{if(h.searchSort==5){createMpingEvent("MShop_AllProductNew","",window.location.pathname,h.shopId)}else{if(h.searchSort==2||h.searchSort==3){createMpingEvent("MShop_AllProductPrice","",window.location.pathname,h.shopId)}}}}}e();h.load(function(){var b=$("#J-sortTab").outerHeight();var c=$("#commonList").offset().top-b+1;$("html,body").animate({scrollTop:c+"px"},300)})});function e(){h.searchPage=1;$("#searchPage").val(h.searchPage);h.pageCount=0;h.isEnd=false;if($(".loading-more").hasClass("hide")==true){$(".loading-more").removeClass("hide")}}},initList:function(e){var f=this;var d='<div class="sort-list"><ul></ul></div><div class="loading-more"><div class="loading-ani"><span class="loading-more-l"><i class="load-circel"></i><i class="load-logo"></i></span><span class="load-text">加载中...</span></div><div class="loading-no hide">商品就这些了，去看看其他商品吧～</div></div>';d+='<div class="empty-section hide">    <i class="empty-icon"></i>    <div class="empty-title">抱歉，暂无符合条件的商品</div>    <div class="empty-tips">去其他地方看看吧</div>    <div class="empty-btn-box">';if((this.shopCategoryId!=null&&this.shopCategoryId!="")||(this.keyword!=null&&this.keyword!="")){d+='<div class="empty-btn" type="home">查看店铺首页</div>';d+='<div class="empty-btn" type="all">查看全部商品</div>'}d+="</div></div>";e.append(d);$(window).scroll(function(){var a=f.getUndisplayBodySize();if(a<250&&f.loadflag==false&&f.isEnd==false){f.load()}});this.divId.find("ul").on("click","li",function(){$("#scrollTop").val($(document).scrollTop());var a=$(this).attr("wareId");createMpingEvent("MShop_AllProductProduct",a+"_"+f.shopId,window.location.pathname,f.shopId,"4");setTimeout(function(){window.location.href="//item.m.jd.com/product/"+a+".html"},100)})},getUndisplayBodySize:function(){var d=$(document.body).outerHeight(true);var f=$(window).height();var e=$(document).scrollTop();return d-e-f},getQueryString:function(e){var d=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var f=window.location.search.substr(1).match(d);if(f!=null){return unescape(f[2])}return null},savePosition:function(){$("#searchPage").val(this.searchPage);$("#scrollTop").val($(document).scrollTop())},load:function(g){if(this.loadflag==true){return}this.loadflag=true;var h=this;if(h.searchPage>1){h.clickSku=null;h.skus=null}setTimeout(function(){jQuery.ajax({url:"/search/searchWareAjax.json?r="+new Date().getTime(),dataType:"json",data:{shopId:h.shopId,searchPage:h.searchPage,keyword:h.keyword,searchSort:h.searchSort,shopCategoryId:h.shopCategoryId,clickSku:h.clickSku,skus:h.skus},type:"post",success:function(a){if(a!=null&&a.success==true){if(a.results==null||a.results.wareInfo==null||a.results.wareInfo.length==0){e();h.isEnd=true}else{if(a.results.totalPage){if(h.pageCount==0){h.pageCount=a.results.totalPage}if(h.pageCount==h.searchPage){$(".loading-ani").addClass("hide");$(".loading-no").removeClass("hide");h.isEnd=true}}var b="";if(a.results.topWare&&a.results.topWare.length>0){for(var c=0;c<a.results.topWare.length;c++){b+=f(a.results.topWare[c])}}for(var c=0;c<a.results.wareInfo.length;c++){b+=f(a.results.wareInfo[c])}if(h.searchPage==1){h.divId.find("ul").html(b)}else{h.divId.find("ul").append(b)}++h.searchPage}}else{e();if(a.message){toast(a.message,"danger")}else{toast("获取列表失败","danger")}}},error:function(){e();toast("加载失败，请稍后重试","danger")},complete:function(){h.loadflag=false;if($.type(g)==="function"){g()}}})},300);function f(a){var b="";var c="";if(a.stock!=null&&a.stock=="0"){c='class="pro-soldout"'}else{if(a.isUnderCarriage!=null&&a.isUnderCarriage=="1"){c='class="pro-offshelf"'}}if(c!=""){b='<i class="pro-status-icon"></i>'}var d='<li wareId="'+a.wareId+'"><a href="javascript:void(0);" '+c+'><span class="img-box"><img src="'+a.imageurl+'" alt="'+a.wname+'">'+b+'</span><span class="pro-desc">'+a.wname+'</span><span class="pro-price">';if(isNaN(a.jdPrice)){d+='<span class="price-info">'+a.jdPrice+"</span>"}else{if(a.jdPrice==="-1.00"){d+='<span class="price-info">暂无报价</span>'}else{d+='<span class="price-info"><em class="price-yen">&yen;</em><em class="price-int">'+a.jdPrice.split(".")[0]+'</em><em class="price-decimal">.'+a.jdPrice.split(".")[1]+"</em></span>"}}if(a.spPrice==""||isNaN(a.spPrice)){d+=a.promName!=null?'<i class="price-tags">'+a.promName+"</i>":"";d+=a.promotionFlag!=null&&a.promotionFlag[100]!=null&&a.promotionFlag[100]=="掌上专享"?'<i class="icon-mobile"></i>':""}d+="</span>";d+='<span class="pro-price-sams">';if(a.spPrice!=""&&!isNaN(a.spPrice)){d+='<em class="price-yen">&yen;</em><em class="price-int">'+a.spPrice.split(".")[0]+'</em><em class="price-decimal">.'+a.spPrice.split(".")[1]+'</em><i class="sams-tag"></i>'}d+="</span>";d+="</a></li>";return d}function e(){$(".loading-more").addClass("hide");if(h.searchPage==1){$(".empty-section").removeClass("hide")}}}};var shopSearch=shopSearch||null;shopSearch={init:function(){shopSearch.handleSort()},handleSort:function(){var d=$("#J-sortTab").find(".sort-item"),f=$("#J-priceSort"),e=f.find(".sort-icon");d.click(function(){$(this).addClass("active").siblings().removeClass("active");if($(this).attr("id")!="J-priceSort"){f.removeClass("price-up").removeClass("price-down")}});f.click(function(){if($(this).hasClass("price-up")){$(this).removeClass("price-up").addClass("price-down")}else{$(this).removeClass("price-down").addClass("price-up")}})}};