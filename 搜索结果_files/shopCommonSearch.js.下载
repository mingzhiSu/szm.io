var shopCommon=shopCommon||null;$.smartScroll=function(f,h){if(!h||f.data("isBindScroll")){return}var g;var e={posY:0,maxscroll:0};f.on({touchstart:function(b){var c=b.originalEvent.touches[0]||b.touches[0]||b;var a=$(b.target);if(!a.length){return}var d;if(a.is(h)){d=a}else{if((d=a.parents(h)).length==0){d=null}}if(!d){return}e.elScroll=d;e.posY=c.pageY;e.scrollY=d.scrollTop();e.maxscroll=d[0].scrollHeight-d[0].clientHeight},touchmove:function(){if(e.maxscroll<=0||g){event.preventDefault()}var d=e.elScroll;var a=d.scrollTop();var c=event.touches[0]||event;var b=c.pageY-e.posY;if(g){d.scrollTop(e.scrollY-b);d.trigger("scroll");return}if(b>0&&a==0){event.preventDefault();return}if(b<0&&(a+1>=e.maxscroll)){event.preventDefault();return}},touchend:function(){e.maxscroll=0}});f.data("isBindScroll",true)};shopCommon={init:function(){shopCommon.handleGoto();shopCommon.handleMenu();shopCommon.handleSeach()},handleGoto:function(){var d=$("#J-gotop"),c=window.innerHeight||window.screen.height;$(window).on("scroll touchmove",function(){(window.scrollY<1.5*c)?d.addClass("hide"):d.removeClass("hide");if(window.scrollY>50){$(".header-fixed").css("top","0px")}else{if($(".download-pannel")&&!$(".download-pannel").is(":hidden")&&$(".download-pannel").height()>0){$(".header-fixed").css("top",(50-window.scrollY)+"px")}}var a=$(".index-recom-layer");if(a&&a.length>0){$(a).addClass("hide");if($.isStorageSupported()){window.sessionStorage.setItem("recomShow_"+$("#shopId").val(),"1")}}});d.click(function(){$(window).scrollTop(0,0)})},handleMenu:function(){$("#J-menu").click(function(){var c=$("#active").val();var d=$("#shopId").val();if(window.location.pathname=="/"||window.location.pathname.indexOf("index")!=-1){createMpingEvent("MShop_Classification","",window.location.pathname,d,"")}else{createMpingEvent("MShop_AllProductClass","",window.location.pathname,d,"")}setTimeout(function(){window.location.href="/category/list.action?shopId="+$("#shopId").val()+"#active="+c},100)})},handleSeach:function(){function w(a){if(a&&a.length>0){$("#J-searchBtn").addClass("red");$("#J-searchClear").removeClass("hide")}else{$("#J-searchBtn").removeClass("red");$("#J-searchClear").addClass("hide")}}var n=$("#keyword"),m=$("#J-searchBar"),t=m.find(".search-icon"),r=m.find(".search-clear"),v=$("#J-searchCancel"),x=$("#J-menu"),q=$("#J-searchBtn"),s=$("#J-headerBack");var p=$("#keywordShow");var o=$(".search-layer-section");p.click(function(){w($(this).val());o.removeClass("hide");$.smartScroll(o,".scrollable");$("html").addClass("noscroll");$("#J-searchLayer").find(".header-search").addClass("search-focus");$("#J-searchLayer").find(".search-input").focus();createMpingEvent("MShop_Search","",window.location.pathname,$("#shopId").val(),"3")});n.keyup(function(){var a=$(this).val();w(a)});function u(){$("html").removeClass("noscroll");o.addClass("hide");r.addClass("hide")}$("#J-searchCancel").click(function(a){a.stopPropagation();n.val("");n.blur();p.val("");p.blur();u();createMpingEvent("MShop_SearchCancel","",window.location.pathname,$("#shopId").val())});$("#searchInputMask").click(function(){u();n.val("");n.blur()});$(".result-item-link,.result-item-title").click(function(){var b=$(this).parent().attr("cateId");var c=$(this).attr("all");var a=$(this).parent().attr("cateName");if(c==="1"){window.location.href="/search?shopId="+$("#shopId").val()}else{window.location.href="/search?shopId="+$("#shopId").val()+"&shopCategoryId="+b+"&active="+b+"&keywordShow="+a}});$(".link-item").click(function(){var b=$(this).attr("cateId");var a=$(this).attr("cateName");window.location.href="/search?shopId="+$("#shopId").val()+"&shopCategoryId="+b+"&active="+b+"&keywordShow="+a});$("#J-searchClear").click(function(){n.blur();n.val("")});$("#searchForm").submit(function(){createMpingEvent("MShop_StartSearch","",window.location.pathname,$("#shopId").val());u();$("#searchPage").val("");$("#searchSort").val("");$("#shopCategoryId").val("");var a=this;setTimeout(function(){var b="/search?"+$(a).serialize();if($("#searchPageFlag").length>0){window.location.replace(b)}else{window.location.href=b}},100);return false});q.click(function(){$("#searchForm").submit()})}};$(function(){shopCommon.init()});